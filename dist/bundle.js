!function(Q,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("ecstatic",[],n):"object"==typeof exports?exports.ecstatic=n():Q.ecstatic=n()}(window,(function(){return function(Q){var n=window.webpackHotUpdateecstatic;window.webpackHotUpdateecstatic=function(Q,e){!function(Q,n){if(!a[Q]||!y[Q])return;for(var e in y[Q]=!1,n)Object.prototype.hasOwnProperty.call(n,e)&&(b[e]=n[e]);0==--G&&0===u&&X()}(Q,e),n&&n(Q,e)};var e,t=!0,B="e218ee2da26e10e836b0",i={},F=[],s=[];function c(Q){var n=E[Q];if(!n)return N;var t=function(t){return n.hot.active?(E[t]?-1===E[t].parents.indexOf(Q)&&E[t].parents.push(Q):(F=[Q],e=t),-1===n.children.indexOf(t)&&n.children.push(t)):(console.warn("[HMR] unexpected require("+t+") from disposed module "+Q),F=[]),N(t)},B=function(Q){return{configurable:!0,enumerable:!0,get:function(){return N[Q]},set:function(n){N[Q]=n}}};for(var i in N)Object.prototype.hasOwnProperty.call(N,i)&&"e"!==i&&"t"!==i&&Object.defineProperty(t,i,B(i));return t.e=function(Q){return"ready"===l&&I("prepare"),u++,N.e(Q).then(n,(function(Q){throw n(),Q}));function n(){u--,"prepare"===l&&(r[Q]||p(Q),0===u&&0===G&&X())}},t.t=function(Q,n){return 1&n&&(Q=t(Q)),N.t(Q,-2&n)},t}function U(n){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_selfInvalidated:!1,_disposeHandlers:[],_main:e!==n,active:!0,accept:function(Q,n){if(void 0===Q)t._selfAccepted=!0;else if("function"==typeof Q)t._selfAccepted=Q;else if("object"==typeof Q)for(var e=0;e<Q.length;e++)t._acceptedDependencies[Q[e]]=n||function(){};else t._acceptedDependencies[Q]=n||function(){}},decline:function(Q){if(void 0===Q)t._selfDeclined=!0;else if("object"==typeof Q)for(var n=0;n<Q.length;n++)t._declinedDependencies[Q[n]]=!0;else t._declinedDependencies[Q]=!0},dispose:function(Q){t._disposeHandlers.push(Q)},addDisposeHandler:function(Q){t._disposeHandlers.push(Q)},removeDisposeHandler:function(Q){var n=t._disposeHandlers.indexOf(Q);n>=0&&t._disposeHandlers.splice(n,1)},invalidate:function(){switch(this._selfInvalidated=!0,l){case"idle":(b={})[n]=Q[n],I("ready");break;case"ready":R(n);break;case"prepare":case"check":case"dispose":case"apply":(C=C||[]).push(n)}},check:x,apply:Z,status:function(Q){if(!Q)return l;d.push(Q)},addStatusHandler:function(Q){d.push(Q)},removeStatusHandler:function(Q){var n=d.indexOf(Q);n>=0&&d.splice(n,1)},data:i[n]};return e=void 0,t}var d=[],l="idle";function I(Q){l=Q;for(var n=0;n<d.length;n++)d[n].call(null,Q)}var g,b,o,C,G=0,u=0,r={},y={},a={};function V(Q){return+Q+""===Q?+Q:Q}function x(Q){if("idle"!==l)throw new Error("check() is only allowed in idle status");return t=Q,I("check"),(n=1e4,n=n||1e4,new Promise((function(Q,e){if("undefined"==typeof XMLHttpRequest)return e(new Error("No browser support"));try{var t=new XMLHttpRequest,B=N.p+"hot/hot-update.json";t.open("GET",B,!0),t.timeout=n,t.send(null)}catch(Q){return e(Q)}t.onreadystatechange=function(){if(4===t.readyState)if(0===t.status)e(new Error("Manifest request to "+B+" timed out."));else if(404===t.status)Q();else if(200!==t.status&&304!==t.status)e(new Error("Manifest request to "+B+" failed."));else{try{var n=JSON.parse(t.responseText)}catch(Q){return void e(Q)}Q(n)}}}))).then((function(Q){if(!Q)return I(L()?"ready":"idle"),null;y={},r={},a=Q.c,o=Q.h,I("prepare");var n=new Promise((function(Q,n){g={resolve:Q,reject:n}}));b={};return p(0),"prepare"===l&&0===u&&0===G&&X(),n}));var n}function p(Q){var n;a[Q]?(y[Q]=!0,G++,(n=document.createElement("script")).charset="utf-8",n.src=N.p+"hot/hot-update.js",document.head.appendChild(n)):r[Q]=!0}function X(){I("ready");var Q=g;if(g=null,Q)if(t)Promise.resolve().then((function(){return Z(t)})).then((function(n){Q.resolve(n)}),(function(n){Q.reject(n)}));else{var n=[];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&n.push(V(e));Q.resolve(n)}}function Z(n){if("ready"!==l)throw new Error("apply() is only allowed in ready status");return function n(t){var s,c,U,d,l;function g(Q){for(var n=[Q],e={},t=n.map((function(Q){return{chain:[Q],id:Q}}));t.length>0;){var B=t.pop(),i=B.id,F=B.chain;if((d=E[i])&&(!d.hot._selfAccepted||d.hot._selfInvalidated)){if(d.hot._selfDeclined)return{type:"self-declined",chain:F,moduleId:i};if(d.hot._main)return{type:"unaccepted",chain:F,moduleId:i};for(var s=0;s<d.parents.length;s++){var c=d.parents[s],U=E[c];if(U){if(U.hot._declinedDependencies[i])return{type:"declined",chain:F.concat([c]),moduleId:i,parentId:c};-1===n.indexOf(c)&&(U.hot._acceptedDependencies[i]?(e[c]||(e[c]=[]),G(e[c],[i])):(delete e[c],n.push(c),t.push({chain:F.concat([c]),id:c})))}}}}return{type:"accepted",moduleId:Q,outdatedModules:n,outdatedDependencies:e}}function G(Q,n){for(var e=0;e<n.length;e++){var t=n[e];-1===Q.indexOf(t)&&Q.push(t)}}L();var u={},r=[],y={},x=function(){console.warn("[HMR] unexpected require("+X.moduleId+") to disposed module")};for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p)){var X;l=V(p),X=b[p]?g(l):{type:"disposed",moduleId:p};var Z=!1,R=!1,A=!1,m="";switch(X.chain&&(m="\nUpdate propagation: "+X.chain.join(" -> ")),X.type){case"self-declined":t.onDeclined&&t.onDeclined(X),t.ignoreDeclined||(Z=new Error("Aborted because of self decline: "+X.moduleId+m));break;case"declined":t.onDeclined&&t.onDeclined(X),t.ignoreDeclined||(Z=new Error("Aborted because of declined dependency: "+X.moduleId+" in "+X.parentId+m));break;case"unaccepted":t.onUnaccepted&&t.onUnaccepted(X),t.ignoreUnaccepted||(Z=new Error("Aborted because "+l+" is not accepted"+m));break;case"accepted":t.onAccepted&&t.onAccepted(X),R=!0;break;case"disposed":t.onDisposed&&t.onDisposed(X),A=!0;break;default:throw new Error("Unexception type "+X.type)}if(Z)return I("abort"),Promise.reject(Z);if(R)for(l in y[l]=b[l],G(r,X.outdatedModules),X.outdatedDependencies)Object.prototype.hasOwnProperty.call(X.outdatedDependencies,l)&&(u[l]||(u[l]=[]),G(u[l],X.outdatedDependencies[l]));A&&(G(r,[X.moduleId]),y[l]=x)}var W,h=[];for(c=0;c<r.length;c++)l=r[c],E[l]&&E[l].hot._selfAccepted&&y[l]!==x&&!E[l].hot._selfInvalidated&&h.push({module:l,parents:E[l].parents.slice(),errorHandler:E[l].hot._selfAccepted});I("dispose"),Object.keys(a).forEach((function(Q){!1===a[Q]&&function(Q){delete installedChunks[Q]}(Q)}));var D,S,H=r.slice();for(;H.length>0;)if(l=H.pop(),d=E[l]){var v={},f=d.hot._disposeHandlers;for(U=0;U<f.length;U++)(s=f[U])(v);for(i[l]=v,d.hot.active=!1,delete E[l],delete u[l],U=0;U<d.children.length;U++){var Y=E[d.children[U]];Y&&((W=Y.parents.indexOf(l))>=0&&Y.parents.splice(W,1))}}for(l in u)if(Object.prototype.hasOwnProperty.call(u,l)&&(d=E[l]))for(S=u[l],U=0;U<S.length;U++)D=S[U],(W=d.children.indexOf(D))>=0&&d.children.splice(W,1);I("apply"),void 0!==o&&(B=o,o=void 0);for(l in b=void 0,y)Object.prototype.hasOwnProperty.call(y,l)&&(Q[l]=y[l]);var T=null;for(l in u)if(Object.prototype.hasOwnProperty.call(u,l)&&(d=E[l])){S=u[l];var J=[];for(c=0;c<S.length;c++)if(D=S[c],s=d.hot._acceptedDependencies[D]){if(-1!==J.indexOf(s))continue;J.push(s)}for(c=0;c<J.length;c++){s=J[c];try{s(S)}catch(Q){t.onErrored&&t.onErrored({type:"accept-errored",moduleId:l,dependencyId:S[c],error:Q}),t.ignoreErrored||T||(T=Q)}}}for(c=0;c<h.length;c++){var z=h[c];l=z.module,F=z.parents,e=l;try{N(l)}catch(Q){if("function"==typeof z.errorHandler)try{z.errorHandler(Q)}catch(n){t.onErrored&&t.onErrored({type:"self-accept-error-handler-errored",moduleId:l,error:n,originalError:Q}),t.ignoreErrored||T||(T=n),T||(T=Q)}else t.onErrored&&t.onErrored({type:"self-accept-errored",moduleId:l,error:Q}),t.ignoreErrored||T||(T=Q)}}if(T)return I("fail"),Promise.reject(T);if(C)return n(t).then((function(Q){return r.forEach((function(n){Q.indexOf(n)<0&&Q.push(n)})),Q}));return I("idle"),new Promise((function(Q){Q(r)}))}(n=n||{})}function L(){if(C)return b||(b={}),C.forEach(R),C=void 0,!0}function R(n){Object.prototype.hasOwnProperty.call(b,n)||(b[n]=Q[n])}var E={};function N(n){if(E[n])return E[n].exports;var e=E[n]={i:n,l:!1,exports:{},hot:U(n),parents:(s=F,F=[],s),children:[]};return Q[n].call(e.exports,e,e.exports,c(n)),e.l=!0,e.exports}return N.m=Q,N.c=E,N.d=function(Q,n,e){N.o(Q,n)||Object.defineProperty(Q,n,{enumerable:!0,get:e})},N.r=function(Q){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(Q,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(Q,"__esModule",{value:!0})},N.t=function(Q,n){if(1&n&&(Q=N(Q)),8&n)return Q;if(4&n&&"object"==typeof Q&&Q&&Q.__esModule)return Q;var e=Object.create(null);if(N.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:Q}),2&n&&"string"!=typeof Q)for(var t in Q)N.d(e,t,function(n){return Q[n]}.bind(null,t));return e},N.n=function(Q){var n=Q&&Q.__esModule?function(){return Q.default}:function(){return Q};return N.d(n,"a",n),n},N.o=function(Q,n){return Object.prototype.hasOwnProperty.call(Q,n)},N.p="/static/",N.h=function(){return B},c(0)(N.s=0)}([function(Q,n,e){Q.exports=e(1)},function(module,__webpack_exports__,__webpack_require__){"use strict";eval('// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, "World", function() { return /* reexport */ World_World; });\n__webpack_require__.d(__webpack_exports__, "createEntity", function() { return /* reexport */ createEntity; });\n__webpack_require__.d(__webpack_exports__, "createSystem", function() { return /* reexport */ createSystem; });\n\n// CONCATENATED MODULE: ./src/ComponentCollection.ts\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nclass ComponentCollection {\n  constructor() {\n    _defineProperty(this, "components", new Map());\n\n    _defineProperty(this, "add", component => {\n      this.components.set(component.type, component);\n    });\n\n    _defineProperty(this, "update", (cType, func) => {\n      if (this.components.has(cType)) {\n        const c = this.components.get(cType);\n\n        if (c) {\n          const updatedComponent = func(c);\n          this.components.set(cType, updatedComponent);\n        }\n      }\n    });\n\n    _defineProperty(this, "remove", cType => {\n      this.components.delete(cType);\n    });\n\n    _defineProperty(this, "get", cType => {\n      if (!this.components.has(cType)) {\n        throw new Error(`ComponentCollection does not have component of type ${cType}`);\n      }\n\n      return this.components.get(cType);\n    });\n\n    _defineProperty(this, "has", cType => {\n      if (Array.isArray(cType)) {\n        return cType.every(ct => this.components.has(ct) === true);\n      } else {\n        return this.components.has(cType);\n      }\n    });\n  }\n\n  get componentTypes() {\n    return [...this.components.keys()];\n  }\n\n  get size() {\n    return this.components.size;\n  }\n\n}\n// CONCATENATED MODULE: ./src/World.ts\nfunction World_defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\nclass World_World {\n  constructor() {\n    World_defineProperty(this, "componentCollections", new Map());\n\n    World_defineProperty(this, "entities", new Map());\n\n    World_defineProperty(this, "entitiesByCTypes", new Map());\n\n    World_defineProperty(this, "entitiesByTags", new Map());\n\n    World_defineProperty(this, "find", predicate => {\n      for (const entity of this.entities.values()) {\n        if (predicate(entity)) {\n          return entity;\n        }\n      }\n\n      return null;\n    });\n\n    World_defineProperty(this, "findAll", predicate => {\n      const results = [];\n\n      for (const entity of this.entities.values()) {\n        if (predicate(entity)) {\n          results.push(entity);\n        }\n      }\n\n      return results;\n    });\n\n    World_defineProperty(this, "locate", cTypes => {\n      for (const entity of this.entities.values()) {\n        if (entity.components.has(cTypes)) {\n          return entity;\n        }\n      }\n\n      return null;\n    });\n\n    World_defineProperty(this, "locateAll", cTypes => {\n      const results = [];\n\n      for (const entity of this.entities.values()) {\n        if (entity.components.has(cTypes)) {\n          results.push(entity);\n        }\n      }\n\n      return results;\n    });\n\n    World_defineProperty(this, "grab", cType => {\n      const entity = this.locate(cType);\n\n      if (entity) {\n        const cc = this.componentCollections.get(entity.id) || new ComponentCollection();\n        const component = cc.get(cType);\n        return {\n          entity,\n          component\n        };\n      }\n\n      return null;\n    });\n\n    World_defineProperty(this, "grabBy", (cType, predicate) => {\n      const entities = this.locateAll(cType);\n\n      for (const entity of entities) {\n        const cc = this.componentCollections.get(entity.id) || new ComponentCollection();\n        const component = cc.get(cType);\n\n        if (predicate(component)) {\n          return {\n            component,\n            entity\n          };\n        }\n      }\n\n      return null;\n    });\n\n    World_defineProperty(this, "grabAll", cType => {\n      return this.locateAll(cType).map(entity => ({\n        entity,\n        component: entity.components.get(cType)\n      }));\n    });\n\n    World_defineProperty(this, "get", (eid, cType) => {\n      const cc = this.componentCollections.get(eid) || new ComponentCollection();\n      return cc.get(cType);\n    });\n\n    World_defineProperty(this, "getTagged", tag => {\n      let entities = [];\n      const tagEntityIds = this.entitiesByTags.get(tag);\n\n      if (tagEntityIds) {\n        for (const entityId of tagEntityIds) {\n          const entity = this.entities.get(entityId);\n\n          if (entity) {\n            entities.push(entity);\n          }\n        }\n      }\n\n      return entities;\n    });\n\n    World_defineProperty(this, "set", (eid, component) => {\n      const cc = this.componentCollections.get(eid) || new ComponentCollection();\n      cc.add(component);\n      this.componentCollections.set(eid, cc);\n\n      for (const [ctArr, entitySet] of this.entitiesByCTypes) {\n        if (ctArr.every(cc.has)) {\n          entitySet.add(eid);\n        }\n      }\n\n      return this;\n    });\n\n    World_defineProperty(this, "remove", (eid, cType) => {\n      const cc = this.componentCollections.get(eid) || new ComponentCollection(); // remove entity from current entitiesByCTypes\n\n      for (const [ctArr, entitySet] of this.entitiesByCTypes) {\n        if (ctArr.every(cc.has)) {\n          entitySet.delete(eid);\n        }\n      }\n\n      cc.remove(cType); // Move entityId to new CTypes if needed.\n\n      for (const [ctArr, entitySet] of this.entitiesByCTypes) {\n        if (ctArr.every(cc.has)) {\n          entitySet.add(eid);\n        }\n      }\n    });\n  }\n\n  /**\n   * Internal method used in setting up a new system.\n   */\n  registerSystem(cTypes) {\n    this.entitiesByCTypes.set(cTypes, new Set());\n    return this;\n  }\n\n  registerEntity(entity) {\n    const cc = new ComponentCollection();\n    this.componentCollections.set(entity.id, cc);\n    this.entities.set(entity.id, entity);\n    return this;\n  }\n  /**\n   * Remove all components that belong to an entity.\n   */\n\n\n  clearEntityComponents(eid) {\n    this.componentCollections.set(eid, new ComponentCollection());\n\n    for (const entitySet of this.entitiesByCTypes.values()) {\n      if (entitySet.has(eid)) {\n        entitySet.delete(eid);\n      }\n    }\n\n    return this;\n  }\n  /**\n   * Destroys an entity.\n   * Same as entity.destroy().\n   */\n\n\n  destroyEntity(eid) {\n    this.componentCollections.delete(eid);\n    this.entities.delete(eid);\n\n    for (const entitySet of this.entitiesByCTypes.values()) {\n      if (entitySet.has(eid)) {\n        entitySet.delete(eid);\n      }\n    }\n\n    return this;\n  }\n\n}\n// CONCATENATED MODULE: ./node_modules/uuid/dist/esm-browser/rng.js\n// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\n// getRandomValues needs to be invoked in a context where "this" is a Crypto implementation. Also,\n// find the complete implementation of crypto (msCrypto) on IE11.\nvar getRandomValues = typeof crypto !== \'undefined\' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== \'undefined\' && typeof msCrypto.getRandomValues === \'function\' && msCrypto.getRandomValues.bind(msCrypto);\nvar rnds8 = new Uint8Array(16);\nfunction rng() {\n  if (!getRandomValues) {\n    throw new Error(\'crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported\');\n  }\n\n  return getRandomValues(rnds8);\n}\n// CONCATENATED MODULE: ./node_modules/uuid/dist/esm-browser/bytesToUuid.js\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\n\nfor (var bytesToUuid_i = 0; bytesToUuid_i < 256; ++bytesToUuid_i) {\n  byteToHex.push((bytesToUuid_i + 0x100).toString(16).substr(1));\n}\n\nfunction bytesToUuid(buf, offset_) {\n  var offset = offset_ || 0; // Note: Be careful editing this code!  It\'s been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n\n  return (byteToHex[buf[offset + 0]] + byteToHex[buf[offset + 1]] + byteToHex[buf[offset + 2]] + byteToHex[buf[offset + 3]] + \'-\' + byteToHex[buf[offset + 4]] + byteToHex[buf[offset + 5]] + \'-\' + byteToHex[buf[offset + 6]] + byteToHex[buf[offset + 7]] + \'-\' + byteToHex[buf[offset + 8]] + byteToHex[buf[offset + 9]] + \'-\' + byteToHex[buf[offset + 10]] + byteToHex[buf[offset + 11]] + byteToHex[buf[offset + 12]] + byteToHex[buf[offset + 13]] + byteToHex[buf[offset + 14]] + byteToHex[buf[offset + 15]]).toLowerCase();\n}\n\n/* harmony default export */ var esm_browser_bytesToUuid = (bytesToUuid);\n// CONCATENATED MODULE: ./node_modules/uuid/dist/esm-browser/v4.js\n\n\n\nfunction v4(options, buf, offset) {\n  options = options || {};\n  var rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (var i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return esm_browser_bytesToUuid(rnds);\n}\n\n/* harmony default export */ var esm_browser_v4 = (v4);\n// CONCATENATED MODULE: ./src/Entity.ts\nfunction Entity_defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\n\nclass Entity_Entity {\n  constructor(world) {\n    Entity_defineProperty(this, "_id", void 0);\n\n    Entity_defineProperty(this, "_world", void 0);\n\n    this._id = esm_browser_v4();\n    this._world = world;\n    /*\n    Registering with the World.\n    */\n\n    this._world.registerEntity(this);\n  }\n  /**\n   * Add a component to an Entity, doh.\n   */\n\n\n  add(component) {\n    this._world.set(this._id, component);\n\n    return this;\n  }\n  /**\n   * Add a tag to a component\n   */\n\n\n  addTag(tag) {\n    const entitySet = this._world.entitiesByTags.has(tag) ? this._world.entitiesByTags.get(tag) : new Set();\n\n    if (entitySet) {\n      entitySet.add(this._id);\n\n      this._world.entitiesByTags.set(tag, entitySet);\n    }\n\n    return this;\n  }\n  /**\n   * Determines if an entity has a component related to it.\n   */\n\n\n  has(cType) {\n    const cc = this._world.componentCollections.get(this._id) || new ComponentCollection();\n    return cc.has(cType);\n  }\n\n  hasTag(tag) {\n    if (this._world.entitiesByTags.has(tag)) {\n      const entitySet = this._world.entitiesByTags.get(tag);\n\n      if (entitySet) {\n        return entitySet.has(this._id);\n      }\n    }\n\n    return false;\n  }\n  /**\n   * Get a component that belongs to an entity.\n   */\n\n\n  get(cType) {\n    const cc = this._world.componentCollections.get(this._id) || new ComponentCollection();\n    const component = cc.get(cType);\n    return component;\n  }\n  /**\n   * Get all components that have been added to an entity, via a ComponentCollection\n   */\n\n\n  getAll() {\n    return this._world.componentCollections.get(this._id) || new ComponentCollection();\n  }\n\n  remove(cType) {\n    this._world.remove(this._id, cType);\n\n    return this;\n  }\n\n  removeTag(tag) {\n    if (this._world.entitiesByTags.has(tag)) {\n      const entitySet = this._world.entitiesByTags.get(tag);\n\n      if (entitySet) {\n        entitySet.delete(this._id);\n\n        if (entitySet.size === 0) {\n          this._world.entitiesByTags.delete(tag);\n        }\n      }\n    }\n\n    return this;\n  }\n  /** Clears all components from an Entity */\n\n\n  clear() {\n    this._world.clearEntityComponents(this._id);\n\n    return this;\n  }\n\n  clearTags() {\n    for (const [tag, entitySet] of this._world.entitiesByTags.entries()) {\n      entitySet.delete(this._id);\n\n      if (entitySet.size === 0) {\n        this._world.entitiesByTags.delete(tag);\n      }\n    }\n\n    return this;\n  }\n\n  destroy() {\n    this._world.destroyEntity(this._id);\n  }\n\n  get id() {\n    return this._id;\n  }\n\n  get world() {\n    return this._world;\n  }\n  /**\n   * Get all components that have been added to an entity, via a ComponentCollection.\n   * Does the same thing as entityInstance.getAll().\n   */\n\n\n  get components() {\n    return this._world.componentCollections.get(this._id) || new ComponentCollection();\n  }\n  /**\n   * Retrieves all the tags that have been added to this entity.\n   */\n\n\n  get tags() {\n    let tags = new Set();\n\n    for (const [tag, entitySet] of this._world.entitiesByTags.entries()) {\n      if (entitySet.has(this._id)) {\n        tags.add(tag);\n      }\n    }\n\n    return tags;\n  }\n\n}\nfunction createEntity(world) {\n  const entity = new Entity_Entity(world);\n  return entity;\n}\n// CONCATENATED MODULE: ./src/System.ts\n\n\n\n/**\n * This is how you create a System.\n * @example\n * ```\n * createSystem(world, [\'ComponentType\'], ({ entity }) => \'Do fun system things here.\')\n * ```\n */\nfunction createSystem(world, cTypes, systemFunc) {\n  world.registerSystem(cTypes);\n  return () => {\n    let index = 0;\n    const size = world.entitiesByCTypes.size; // Used for matching the array of ComponentTypes which is the key\n    // of where the ComponentCollection is, with the array of ComponentTypes\n    // that are passes.\n    // Might be nice in the future to go back to a ref check on cTypes, but\n    // for now this doesn\'t seem to be that much of a perf hit.\n    // for (const ct of world.entitiesByCTypes.keys()) {\n    //   if (cTypes.length === ct.length && cTypes.every(c => ct.includes(c))) {\n    //     for (const eid of world.entitiesByCTypes.get(cTypes)) {\n    //       const args: SystemFuncArgs<CT> = {\n    //         entity: world.entities.get(eid),\n    //         components: world.componentCollections.get(eid),\n    //         world,\n    //         index,\n    //         size,\n    //         isFirst: index === 0,\n    //         isLast: index + 1 === size,\n    //       }\n    //       systemFunc(args);\n    //       index += 1;\n    //     }\n    //   }\n    // }\n\n    const cTypeArrs = world.entitiesByCTypes.get(cTypes) || new Set();\n\n    for (const eid of cTypeArrs) {\n      const args = {\n        entity: world.entities.get(eid) || new Entity_Entity(world),\n        components: world.componentCollections.get(eid) || new ComponentCollection(),\n        world,\n        index,\n        size,\n        isFirst: index === 0,\n        isLast: index + 1 === size\n      };\n      systemFunc(args);\n      index += 1;\n    }\n  };\n}\n// CONCATENATED MODULE: ./src/index.ts\n\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9lY3N0YXRpYy8uL3NyYy9Db21wb25lbnRDb2xsZWN0aW9uLnRzPzUxYzQiLCJ3ZWJwYWNrOi8vZWNzdGF0aWMvLi9zcmMvV29ybGQudHM/Y2MwYiIsIndlYnBhY2s6Ly9lY3N0YXRpYy8uL25vZGVfbW9kdWxlcy91dWlkL2Rpc3QvZXNtLWJyb3dzZXIvcm5nLmpzP2Q4ZjgiLCJ3ZWJwYWNrOi8vZWNzdGF0aWMvLi9ub2RlX21vZHVsZXMvdXVpZC9kaXN0L2VzbS1icm93c2VyL2J5dGVzVG9VdWlkLmpzP2I2OTEiLCJ3ZWJwYWNrOi8vZWNzdGF0aWMvLi9ub2RlX21vZHVsZXMvdXVpZC9kaXN0L2VzbS1icm93c2VyL3Y0LmpzP2VjMjYiLCJ3ZWJwYWNrOi8vZWNzdGF0aWMvLi9zcmMvRW50aXR5LnRzP2FjNjgiLCJ3ZWJwYWNrOi8vZWNzdGF0aWMvLi9zcmMvU3lzdGVtLnRzPzMyNDgiLCJ3ZWJwYWNrOi8vZWNzdGF0aWMvLi9zcmMvaW5kZXgudHM/ZmZiNCJdLCJuYW1lcyI6WyJDb21wb25lbnRDb2xsZWN0aW9uIiwiTWFwIiwiY29tcG9uZW50IiwiY29tcG9uZW50cyIsInNldCIsInR5cGUiLCJjVHlwZSIsImZ1bmMiLCJoYXMiLCJjIiwiZ2V0IiwidXBkYXRlZENvbXBvbmVudCIsImRlbGV0ZSIsIkVycm9yIiwiQXJyYXkiLCJpc0FycmF5IiwiZXZlcnkiLCJjdCIsImNvbXBvbmVudFR5cGVzIiwia2V5cyIsInNpemUiLCJXb3JsZCIsInByZWRpY2F0ZSIsImVudGl0eSIsImVudGl0aWVzIiwidmFsdWVzIiwicmVzdWx0cyIsInB1c2giLCJjVHlwZXMiLCJsb2NhdGUiLCJjYyIsImNvbXBvbmVudENvbGxlY3Rpb25zIiwiaWQiLCJsb2NhdGVBbGwiLCJtYXAiLCJlaWQiLCJ0YWciLCJ0YWdFbnRpdHlJZHMiLCJlbnRpdGllc0J5VGFncyIsImVudGl0eUlkIiwiYWRkIiwiY3RBcnIiLCJlbnRpdHlTZXQiLCJlbnRpdGllc0J5Q1R5cGVzIiwicmVtb3ZlIiwicmVnaXN0ZXJTeXN0ZW0iLCJTZXQiLCJyZWdpc3RlckVudGl0eSIsImNsZWFyRW50aXR5Q29tcG9uZW50cyIsImRlc3Ryb3lFbnRpdHkiLCJFbnRpdHkiLCJjb25zdHJ1Y3RvciIsIndvcmxkIiwiX2lkIiwidXVpZHY0IiwiX3dvcmxkIiwiYWRkVGFnIiwiaGFzVGFnIiwiZ2V0QWxsIiwicmVtb3ZlVGFnIiwiY2xlYXIiLCJjbGVhclRhZ3MiLCJlbnRyaWVzIiwiZGVzdHJveSIsInRhZ3MiLCJjcmVhdGVFbnRpdHkiLCJjcmVhdGVTeXN0ZW0iLCJzeXN0ZW1GdW5jIiwiaW5kZXgiLCJjVHlwZUFycnMiLCJhcmdzIiwiaXNGaXJzdCIsImlzTGFzdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFFZSxNQUFNQSxtQkFBTixDQUE4QjtBQUFBO0FBQUEsd0NBQ0UsSUFBSUMsR0FBSixFQURGOztBQUFBLGlDQUdwQ0MsU0FBRCxJQUFvQztBQUN4QyxXQUFLQyxVQUFMLENBQWdCQyxHQUFoQixDQUFvQkYsU0FBUyxDQUFDRyxJQUE5QixFQUFvQ0gsU0FBcEM7QUFDRCxLQUwwQzs7QUFBQSxvQ0FPbEMsQ0FBQ0ksS0FBRCxFQUFZQyxJQUFaLEtBQWdFO0FBQ3ZFLFVBQUksS0FBS0osVUFBTCxDQUFnQkssR0FBaEIsQ0FBb0JGLEtBQXBCLENBQUosRUFBZ0M7QUFDOUIsY0FBTUcsQ0FBQyxHQUFHLEtBQUtOLFVBQUwsQ0FBZ0JPLEdBQWhCLENBQW9CSixLQUFwQixDQUFWOztBQUVBLFlBQUlHLENBQUosRUFBTztBQUNMLGdCQUFNRSxnQkFBZ0IsR0FBR0osSUFBSSxDQUFDRSxDQUFELENBQTdCO0FBQ0EsZUFBS04sVUFBTCxDQUFnQkMsR0FBaEIsQ0FBb0JFLEtBQXBCLEVBQTJCSyxnQkFBM0I7QUFDRDtBQUNGO0FBQ0YsS0FoQjBDOztBQUFBLG9DQWtCakNMLEtBQUQsSUFBcUI7QUFDNUIsV0FBS0gsVUFBTCxDQUFnQlMsTUFBaEIsQ0FBdUJOLEtBQXZCO0FBQ0QsS0FwQjBDOztBQUFB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QyxJQUFJa0IsR0FBSixFQUF4RDs7QUFFQSxTQUFLLE1BQU1YLEdBQVgsSUFBa0JrQyxTQUFsQixFQUE2QjtBQUMzQixZQUFNQyxJQUF3QixHQUFHO0FBQy9CL0MsY0FBTSxFQUFFNkIsS0FBSyxDQUFDNUIsUUFBTixDQUFlZCxHQUFmLENBQW1CeUIsR0FBbkIsS0FBMkIsSUFBSWUsYUFBSixDQUFlRSxLQUFmLENBREo7QUFFL0JqRCxrQkFBVSxFQUFFaUQsS0FBSyxDQUFDckIsb0JBQU4sQ0FBMkJyQixHQUEzQixDQUErQnlCLEdBQS9CLEtBQXVDLElBQUluQyxtQkFBSixFQUZwQjtBQUcvQm9ELGFBSCtCO0FBSS9CZ0IsYUFKK0I7QUFLL0JoRCxZQUwrQjtBQU0vQm1ELGVBQU8sRUFBRUgsS0FBSyxLQUFLLENBTlk7QUFPL0JJLGNBQU0sRUFBRUosS0FBSyxHQUFHLENBQVIsS0FBY2hEO0FBUFMsT0FBakM7QUFVQStDLGdCQUFVLENBQUNHLElBQUQsQ0FBVjtBQUVBRixXQUFLLElBQUksQ0FBVDtBQUNEO0FBQ0YsR0E5Q0Q7QUErQ0QsQzs7QUM1R0Q7QUFDQTtBQUNBIiwiZmlsZSI6IjEuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tICcuL0NvbXBvbmVudCc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENvbXBvbmVudENvbGxlY3Rpb248Q1Q+IHtcbiAgcHJpdmF0ZSBjb21wb25lbnRzOiBNYXA8Q1QsIENvbXBvbmVudDxDVD4+ID0gbmV3IE1hcCgpO1xuXG4gIGFkZCA9IChjb21wb25lbnQ6IENvbXBvbmVudDxDVD4pOiB2b2lkID0+IHtcbiAgICB0aGlzLmNvbXBvbmVudHMuc2V0KGNvbXBvbmVudC50eXBlLCBjb21wb25lbnQpO1xuICB9XG5cbiAgdXBkYXRlID0gKGNUeXBlOiBDVCwgZnVuYzogKGM6IENvbXBvbmVudDxDVD4pID0+IENvbXBvbmVudDxDVD4pOiB2b2lkID0+IHtcbiAgICBpZiAodGhpcy5jb21wb25lbnRzLmhhcyhjVHlwZSkpIHtcbiAgICAgIGNvbnN0IGMgPSB0aGlzLmNvbXBvbmVudHMuZ2V0KGNUeXBlKTtcblxuICAgICAgaWYgKGMpIHtcbiAgICAgICAgY29uc3QgdXBkYXRlZENvbXBvbmVudCA9IGZ1bmMoYyk7XG4gICAgICAgIHRoaXMuY29tcG9uZW50cy5zZXQoY1R5cGUsIHVwZGF0ZWRDb21wb25lbnQpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICByZW1vdmUgPSAoY1R5cGU6IENUKTogdm9pZCA9PiB7XG4gICAgdGhpcy5jb21wb25lbnRzLmRlbGV0ZShjVHlwZSk7XG4gIH1cblxuICBnZXQgPSA8Qz4oY1R5cGU6IENUKTogQyA9PiB7XG4gICAgaWYgKCF0aGlzLmNvbXBvbmVudHMuaGFzKGNUeXBlKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb21wb25lbnRDb2xsZWN0aW9uIGRvZXMgbm90IGhhdmUgY29tcG9uZW50IG9mIHR5cGUgJHtjVHlwZX1gKVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gdGhpcy5jb21wb25lbnRzLmdldChjVHlwZSkgYXMgdW5rbm93biBhcyBDO1xuICB9XG5cbiAgaGFzID0gKGNUeXBlOiBDVCB8IENUW10pOiBib29sZWFuID0+IHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShjVHlwZSkpIHtcbiAgICAgIHJldHVybiBjVHlwZS5ldmVyeSgoY3QpID0+IHRoaXMuY29tcG9uZW50cy5oYXMoY3QpID09PSB0cnVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuY29tcG9uZW50cy5oYXMoY1R5cGUpXG4gICAgfVxuICB9XG5cbiAgZ2V0IGNvbXBvbmVudFR5cGVzKCk6IENUW10ge1xuICAgIHJldHVybiBbLi4udGhpcy5jb21wb25lbnRzLmtleXMoKV07XG4gIH1cblxuICBnZXQgc2l6ZSgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmNvbXBvbmVudHMuc2l6ZTtcbiAgfVxufVxuIiwiaW1wb3J0IEVudGl0eSwgeyBFbnRpdHlJZCB9IGZyb20gJy4vRW50aXR5JztcbmltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gJy4vQ29tcG9uZW50JztcbmltcG9ydCBDb21wb25lbnRDb2xsZWN0aW9uIGZyb20gJy4vQ29tcG9uZW50Q29sbGVjdGlvbic7XG5pbXBvcnQgeyBUYWcgfSBmcm9tICcuL1RhZyc7XG5cbnR5cGUgRmluZFByZWRpY2F0ZTxDVD4gPSAoZW50aXR5OiBFbnRpdHk8Q1Q+KSA9PiBib29sZWFuO1xuXG50eXBlIEdyYWJQcmVkaWNhdGU8Qz4gPSAoY29tcG9uZW50OiBDKSA9PiBib29sZWFuO1xuXG5pbnRlcmZhY2UgU2luZ2xlQ29tcG9uZW50UmVzcDxDVCwgQz4ge1xuICBlbnRpdHk6IEVudGl0eTxDVD47XG4gIGNvbXBvbmVudDogQztcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgV29ybGQ8Q1Q+IHtcbiAgY29tcG9uZW50Q29sbGVjdGlvbnM6IE1hcDxFbnRpdHlJZCwgQ29tcG9uZW50Q29sbGVjdGlvbjxDVD4+ID0gbmV3IE1hcCgpO1xuXG4gIGVudGl0aWVzOiBNYXA8RW50aXR5SWQsIEVudGl0eTxDVD4+ID0gbmV3IE1hcCgpO1xuXG4gIGVudGl0aWVzQnlDVHlwZXM6IE1hcDxDVFtdLCBTZXQ8RW50aXR5SWQ+PiA9IG5ldyBNYXAoKTtcblxuICBlbnRpdGllc0J5VGFnczogTWFwPFRhZywgU2V0PEVudGl0eUlkPj4gPSBuZXcgTWFwKCk7XG5cbiAgLyoqXG4gICAqIFwiZmluZHNcIiBhIHNpbmdsZSBlbnRpdHkgYmFzZWQgb24gYSBwcmVkaWNhdGVcbiAgICovXG4gIGZpbmQgPSAocHJlZGljYXRlOiBGaW5kUHJlZGljYXRlPENUPik6IEVudGl0eTxDVD4gfCBudWxsID0+IHtcbiAgICBmb3IgKGNvbnN0IGVudGl0eSBvZiB0aGlzLmVudGl0aWVzLnZhbHVlcygpKSB7XG4gICAgICBpZiAocHJlZGljYXRlKGVudGl0eSkpIHtcbiAgICAgICAgcmV0dXJuIGVudGl0eTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbDtcbiAgfTtcblxuICAvKipcbiAgICogXCJmaW5kc1wiIGFsbCBlbnRpdGllcyBiYXNlZCBvbiBhIHByZWRpY2F0ZSwga2luZGEgbGlrZSBmaWx0ZXIuXG4gICAqL1xuICBmaW5kQWxsID0gKHByZWRpY2F0ZTogRmluZFByZWRpY2F0ZTxDVD4pOiBFbnRpdHk8Q1Q+W10gPT4ge1xuICAgIGNvbnN0IHJlc3VsdHM6IEVudGl0eTxDVD5bXSA9IFtdO1xuXG4gICAgZm9yIChjb25zdCBlbnRpdHkgb2YgdGhpcy5lbnRpdGllcy52YWx1ZXMoKSkge1xuICAgICAgaWYgKHByZWRpY2F0ZShlbnRpdHkpKSB7XG4gICAgICAgIHJlc3VsdHMucHVzaChlbnRpdHkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByZXN1bHRzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBcImxvY2F0ZXNcIiBhIHNpbmdsZSBlbnRpdHkgYmFzZWQgb24gaXRzIENvbXBvbmVudHMuXG4gICAqL1xuICBsb2NhdGUgPSAoY1R5cGVzOiBDVCB8IENUW10pOiBFbnRpdHk8Q1Q+IHwgbnVsbCA9PiB7XG4gICAgZm9yIChjb25zdCBlbnRpdHkgb2YgdGhpcy5lbnRpdGllcy52YWx1ZXMoKSkge1xuICAgICAgaWYgKGVudGl0eS5jb21wb25lbnRzLmhhcyhjVHlwZXMpKSB7XG4gICAgICAgIHJldHVybiBlbnRpdHk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH07XG5cbiAgLyoqXG4gICAqIExvY2F0ZXMgYWxsIGVudGl0aWVzIHRoYXQgY29udGFpbiB0aGUgY29tcG9uZW50cyBuYW1lZFxuICAgKi9cbiAgbG9jYXRlQWxsID0gKGNUeXBlczogQ1QgfCBDVFtdKTogRW50aXR5PENUPltdID0+IHtcbiAgICBjb25zdCByZXN1bHRzOiBFbnRpdHk8Q1Q+W10gPSBbXTtcblxuICAgIGZvciAoY29uc3QgZW50aXR5IG9mIHRoaXMuZW50aXRpZXMudmFsdWVzKCkpIHtcbiAgICAgIGlmIChlbnRpdHkuY29tcG9uZW50cy5oYXMoY1R5cGVzKSkge1xuICAgICAgICByZXN1bHRzLnB1c2goZW50aXR5KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfTtcblxuICAvKipcbiAgICogR3JhYnMgdGhlIGZpcnN0IGVudGl0eSwgYW5kIGl0cyByZWxhdGVkIGNvbXBvbmVudCwgdGhhdCBtYXRjaGVzIHRoZSBjb21wb25lbnQgdHlwZS5cbiAgICogQGV4YW1wbGVcbiAgICogYGBgXG4gICAqIGNvbnN0IHsgZW50aXR5LCBjb21wb25lbnQgfSA9IHdvcmxkLmdyYWI8TXlDb21wb25lbnQ+KENvbXBvbmVudHMuTXlDb21wb25lbnQpO1xuICAgKiBgYGBcbiAgICovXG4gIGdyYWIgPSA8Qz4oY1R5cGU6IENUKTogU2luZ2xlQ29tcG9uZW50UmVzcDxDVCwgQz4gfCBudWxsID0+IHtcbiAgICBjb25zdCBlbnRpdHkgPSB0aGlzLmxvY2F0ZShjVHlwZSk7XG5cbiAgICBpZiAoZW50aXR5KSB7XG4gICAgICBjb25zdCBjYyA9XG4gICAgICAgIHRoaXMuY29tcG9uZW50Q29sbGVjdGlvbnMuZ2V0KGVudGl0eS5pZCkgfHxcbiAgICAgICAgbmV3IENvbXBvbmVudENvbGxlY3Rpb248Q1Q+KCk7XG5cbiAgICAgIGNvbnN0IGNvbXBvbmVudCA9IGNjLmdldDxDPihjVHlwZSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGVudGl0eSxcbiAgICAgICAgY29tcG9uZW50LFxuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbDtcbiAgfTtcblxuICAvKipcbiAgICogR3JhYiBzaW5nbGUgY29tcG9uZW50IGJhc2VkIG9uIGNvbXBvbmVudCB0eXBlIGFuZCBwcmVkaWNhdGUuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYHR5cGVzY3JpcHRcbiAgICogY29uc3QgeyBlbnRpdHksIGNvbXBvbmVudCB9ID0gd29ybGQuZ3JhYkJ5KENvbXBvbmVudHMuRmlyc3RDb21wb25lbnQsIChjb21wKSA9PiBjb21wLmlkID09ICdhd2Vzb21lJylcbiAgICogYGBgXG4gICAqL1xuICBncmFiQnkgPSA8Qz4oXG4gICAgY1R5cGU6IENULFxuICAgIHByZWRpY2F0ZTogR3JhYlByZWRpY2F0ZTxDPlxuICApOiBTaW5nbGVDb21wb25lbnRSZXNwPENULCBDPiB8IG51bGwgPT4ge1xuICAgIGNvbnN0IGVudGl0aWVzID0gdGhpcy5sb2NhdGVBbGwoY1R5cGUpO1xuXG4gICAgZm9yIChjb25zdCBlbnRpdHkgb2YgZW50aXRpZXMpIHtcbiAgICAgIGNvbnN0IGNjID1cbiAgICAgICAgdGhpcy5jb21wb25lbnRDb2xsZWN0aW9ucy5nZXQoZW50aXR5LmlkKSB8fFxuICAgICAgICBuZXcgQ29tcG9uZW50Q29sbGVjdGlvbjxDVD4oKTtcblxuICAgICAgY29uc3QgY29tcG9uZW50ID0gY2MuZ2V0PEM+KGNUeXBlKTtcblxuICAgICAgaWYgKHByZWRpY2F0ZShjb21wb25lbnQpKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgY29tcG9uZW50LFxuICAgICAgICAgIGVudGl0eSxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbDtcbiAgfTtcblxuICAvKipcbiAgICogR3JhYiBhbGwgdGhlIGNvbXBvbmVudHMgcHJpbWFyaWx5LCBhbmQgdGhlIGVudGl0aWVzIGlmIG5lZWRlZFxuICAgKi9cbiAgZ3JhYkFsbCA9IDxDPihjVHlwZTogQ1QpOiBTaW5nbGVDb21wb25lbnRSZXNwPENULCBDPltdID0+IHtcbiAgICByZXR1cm4gdGhpcy5sb2NhdGVBbGwoY1R5cGUpLm1hcCgoZW50aXR5KSA9PiAoe1xuICAgICAgZW50aXR5LFxuICAgICAgY29tcG9uZW50OiAoZW50aXR5LmNvbXBvbmVudHMuZ2V0KGNUeXBlKSBhcyB1bmtub3duKSBhcyBDLFxuICAgIH0pKTtcbiAgfTtcblxuICAvKipcbiAgICogR2l2ZW4gYW4gZW50aXR5IGlkIGFuZCBjb21wb25lbnRUeXBlLCByZXR1cm5zIGNvbXBvbmVudFxuICAgKi9cbiAgZ2V0ID0gPEM+KGVpZDogRW50aXR5SWQsIGNUeXBlOiBDVCk6IEMgPT4ge1xuICAgIGNvbnN0IGNjID1cbiAgICAgIHRoaXMuY29tcG9uZW50Q29sbGVjdGlvbnMuZ2V0KGVpZCkgfHwgbmV3IENvbXBvbmVudENvbGxlY3Rpb248Q1Q+KCk7XG5cbiAgICByZXR1cm4gY2MuZ2V0PEM+KGNUeXBlKTtcbiAgfTtcblxuICAvKipcbiAgICogR2V0IGFsbCBlbnRpdGllcyB0aGF0IGhhdmUgYmVlbiBnaXZlbiBhIHRhZy5cbiAgICovXG4gIGdldFRhZ2dlZCA9ICh0YWc6IFRhZyk6IEVudGl0eTxDVD5bXSA9PiB7XG4gICAgbGV0IGVudGl0aWVzOiBFbnRpdHk8Q1Q+W10gPSBbXTtcblxuICAgIGNvbnN0IHRhZ0VudGl0eUlkcyA9IHRoaXMuZW50aXRpZXNCeVRhZ3MuZ2V0KHRhZyk7XG5cbiAgICBpZiAodGFnRW50aXR5SWRzKSB7XG4gICAgICBmb3IgKGNvbnN0IGVudGl0eUlkIG9mIHRhZ0VudGl0eUlkcykge1xuICAgICAgICBjb25zdCBlbnRpdHkgPSB0aGlzLmVudGl0aWVzLmdldChlbnRpdHlJZCk7XG4gICAgICAgIGlmIChlbnRpdHkpIHtcbiAgICAgICAgICBlbnRpdGllcy5wdXNoKGVudGl0eSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZW50aXRpZXM7XG4gIH1cblxuICAvKipcbiAgICogU2V0IGEgY29tcG9uZW50IG9uIHRoZSBnaXZlbiBlbnRpdHlcbiAgICovXG4gIHNldCA9IChlaWQ6IEVudGl0eUlkLCBjb21wb25lbnQ6IENvbXBvbmVudDxDVD4pOiBXb3JsZDxDVD4gPT4ge1xuICAgIGNvbnN0IGNjID1cbiAgICAgIHRoaXMuY29tcG9uZW50Q29sbGVjdGlvbnMuZ2V0KGVpZCkgfHwgbmV3IENvbXBvbmVudENvbGxlY3Rpb248Q1Q+KCk7XG5cbiAgICBjYy5hZGQoY29tcG9uZW50KTtcblxuICAgIHRoaXMuY29tcG9uZW50Q29sbGVjdGlvbnMuc2V0KGVpZCwgY2MpO1xuXG4gICAgZm9yIChjb25zdCBbY3RBcnIsIGVudGl0eVNldF0gb2YgdGhpcy5lbnRpdGllc0J5Q1R5cGVzKSB7XG4gICAgICBpZiAoY3RBcnIuZXZlcnkoY2MuaGFzKSkge1xuICAgICAgICBlbnRpdHlTZXQuYWRkKGVpZCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIFJlbW92ZSBhIGNvbXBvbmVudCBmcm9tIHRoZSBnaXZlbiBlbnRpdHkuXG4gICAqIE5PVEU6IFRoaXMgd2lsbCBjaGFuZ2Ugd2hhdCBzeXN0ZW1zIHdpbGwgYmUgY2FsbGVkIG9uIHRoZSBlbnRpdHkuXG4gICAqL1xuICByZW1vdmUgPSAoZWlkOiBFbnRpdHlJZCwgY1R5cGU6IENUKTogdm9pZCA9PiB7XG4gICAgY29uc3QgY2MgPVxuICAgICAgdGhpcy5jb21wb25lbnRDb2xsZWN0aW9ucy5nZXQoZWlkKSB8fCBuZXcgQ29tcG9uZW50Q29sbGVjdGlvbjxDVD4oKTtcblxuICAgIC8vIHJlbW92ZSBlbnRpdHkgZnJvbSBjdXJyZW50IGVudGl0aWVzQnlDVHlwZXNcbiAgICBmb3IgKGNvbnN0IFtjdEFyciwgZW50aXR5U2V0XSBvZiB0aGlzLmVudGl0aWVzQnlDVHlwZXMpIHtcbiAgICAgIGlmIChjdEFyci5ldmVyeShjYy5oYXMpKSB7XG4gICAgICAgIGVudGl0eVNldC5kZWxldGUoZWlkKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjYy5yZW1vdmUoY1R5cGUpO1xuXG4gICAgLy8gTW92ZSBlbnRpdHlJZCB0byBuZXcgQ1R5cGVzIGlmIG5lZWRlZC5cbiAgICBmb3IgKGNvbnN0IFtjdEFyciwgZW50aXR5U2V0XSBvZiB0aGlzLmVudGl0aWVzQnlDVHlwZXMpIHtcbiAgICAgIGlmIChjdEFyci5ldmVyeShjYy5oYXMpKSB7XG4gICAgICAgIGVudGl0eVNldC5hZGQoZWlkKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEludGVybmFsIG1ldGhvZCB1c2VkIGluIHNldHRpbmcgdXAgYSBuZXcgc3lzdGVtLlxuICAgKi9cbiAgcmVnaXN0ZXJTeXN0ZW0oY1R5cGVzOiBDVFtdKTogV29ybGQ8Q1Q+IHtcbiAgICB0aGlzLmVudGl0aWVzQnlDVHlwZXMuc2V0KGNUeXBlcywgbmV3IFNldDxFbnRpdHlJZD4oKSk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHJlZ2lzdGVyRW50aXR5KGVudGl0eTogRW50aXR5PENUPik6IFdvcmxkPENUPiB7XG4gICAgY29uc3QgY2MgPSBuZXcgQ29tcG9uZW50Q29sbGVjdGlvbjxDVD4oKTtcblxuICAgIHRoaXMuY29tcG9uZW50Q29sbGVjdGlvbnMuc2V0KGVudGl0eS5pZCwgY2MpO1xuICAgIHRoaXMuZW50aXRpZXMuc2V0KGVudGl0eS5pZCwgZW50aXR5KTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSBhbGwgY29tcG9uZW50cyB0aGF0IGJlbG9uZyB0byBhbiBlbnRpdHkuXG4gICAqL1xuICBjbGVhckVudGl0eUNvbXBvbmVudHMoZWlkOiBFbnRpdHlJZCk6IFdvcmxkPENUPiB7XG4gICAgdGhpcy5jb21wb25lbnRDb2xsZWN0aW9ucy5zZXQoZWlkLCBuZXcgQ29tcG9uZW50Q29sbGVjdGlvbjxDVD4oKSk7XG5cbiAgICBmb3IgKGNvbnN0IGVudGl0eVNldCBvZiB0aGlzLmVudGl0aWVzQnlDVHlwZXMudmFsdWVzKCkpIHtcbiAgICAgIGlmIChlbnRpdHlTZXQuaGFzKGVpZCkpIHtcbiAgICAgICAgZW50aXR5U2V0LmRlbGV0ZShlaWQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIERlc3Ryb3lzIGFuIGVudGl0eS5cbiAgICogU2FtZSBhcyBlbnRpdHkuZGVzdHJveSgpLlxuICAgKi9cbiAgZGVzdHJveUVudGl0eShlaWQ6IEVudGl0eUlkKTogV29ybGQ8Q1Q+IHtcbiAgICB0aGlzLmNvbXBvbmVudENvbGxlY3Rpb25zLmRlbGV0ZShlaWQpO1xuICAgIHRoaXMuZW50aXRpZXMuZGVsZXRlKGVpZCk7XG5cbiAgICBmb3IgKGNvbnN0IGVudGl0eVNldCBvZiB0aGlzLmVudGl0aWVzQnlDVHlwZXMudmFsdWVzKCkpIHtcbiAgICAgIGlmIChlbnRpdHlTZXQuaGFzKGVpZCkpIHtcbiAgICAgICAgZW50aXR5U2V0LmRlbGV0ZShlaWQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9XG59XG4iLCIvLyBVbmlxdWUgSUQgY3JlYXRpb24gcmVxdWlyZXMgYSBoaWdoIHF1YWxpdHkgcmFuZG9tICMgZ2VuZXJhdG9yLiBJbiB0aGUgYnJvd3NlciB3ZSB0aGVyZWZvcmVcbi8vIHJlcXVpcmUgdGhlIGNyeXB0byBBUEkgYW5kIGRvIG5vdCBzdXBwb3J0IGJ1aWx0LWluIGZhbGxiYWNrIHRvIGxvd2VyIHF1YWxpdHkgcmFuZG9tIG51bWJlclxuLy8gZ2VuZXJhdG9ycyAobGlrZSBNYXRoLnJhbmRvbSgpKS5cbi8vIGdldFJhbmRvbVZhbHVlcyBuZWVkcyB0byBiZSBpbnZva2VkIGluIGEgY29udGV4dCB3aGVyZSBcInRoaXNcIiBpcyBhIENyeXB0byBpbXBsZW1lbnRhdGlvbi4gQWxzbyxcbi8vIGZpbmQgdGhlIGNvbXBsZXRlIGltcGxlbWVudGF0aW9uIG9mIGNyeXB0byAobXNDcnlwdG8pIG9uIElFMTEuXG52YXIgZ2V0UmFuZG9tVmFsdWVzID0gdHlwZW9mIGNyeXB0byAhPT0gJ3VuZGVmaW5lZCcgJiYgY3J5cHRvLmdldFJhbmRvbVZhbHVlcyAmJiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzLmJpbmQoY3J5cHRvKSB8fCB0eXBlb2YgbXNDcnlwdG8gIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBtc0NyeXB0by5nZXRSYW5kb21WYWx1ZXMgPT09ICdmdW5jdGlvbicgJiYgbXNDcnlwdG8uZ2V0UmFuZG9tVmFsdWVzLmJpbmQobXNDcnlwdG8pO1xudmFyIHJuZHM4ID0gbmV3IFVpbnQ4QXJyYXkoMTYpO1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gcm5nKCkge1xuICBpZiAoIWdldFJhbmRvbVZhbHVlcykge1xuICAgIHRocm93IG5ldyBFcnJvcignY3J5cHRvLmdldFJhbmRvbVZhbHVlcygpIG5vdCBzdXBwb3J0ZWQuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vdXVpZGpzL3V1aWQjZ2V0cmFuZG9tdmFsdWVzLW5vdC1zdXBwb3J0ZWQnKTtcbiAgfVxuXG4gIHJldHVybiBnZXRSYW5kb21WYWx1ZXMocm5kczgpO1xufSIsIi8qKlxuICogQ29udmVydCBhcnJheSBvZiAxNiBieXRlIHZhbHVlcyB0byBVVUlEIHN0cmluZyBmb3JtYXQgb2YgdGhlIGZvcm06XG4gKiBYWFhYWFhYWC1YWFhYLVhYWFgtWFhYWC1YWFhYWFhYWFhYWFhcbiAqL1xudmFyIGJ5dGVUb0hleCA9IFtdO1xuXG5mb3IgKHZhciBpID0gMDsgaSA8IDI1NjsgKytpKSB7XG4gIGJ5dGVUb0hleC5wdXNoKChpICsgMHgxMDApLnRvU3RyaW5nKDE2KS5zdWJzdHIoMSkpO1xufVxuXG5mdW5jdGlvbiBieXRlc1RvVXVpZChidWYsIG9mZnNldF8pIHtcbiAgdmFyIG9mZnNldCA9IG9mZnNldF8gfHwgMDsgLy8gTm90ZTogQmUgY2FyZWZ1bCBlZGl0aW5nIHRoaXMgY29kZSEgIEl0J3MgYmVlbiB0dW5lZCBmb3IgcGVyZm9ybWFuY2VcbiAgLy8gYW5kIHdvcmtzIGluIHdheXMgeW91IG1heSBub3QgZXhwZWN0LiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3V1aWRqcy91dWlkL3B1bGwvNDM0XG5cbiAgcmV0dXJuIChieXRlVG9IZXhbYnVmW29mZnNldCArIDBdXSArIGJ5dGVUb0hleFtidWZbb2Zmc2V0ICsgMV1dICsgYnl0ZVRvSGV4W2J1ZltvZmZzZXQgKyAyXV0gKyBieXRlVG9IZXhbYnVmW29mZnNldCArIDNdXSArICctJyArIGJ5dGVUb0hleFtidWZbb2Zmc2V0ICsgNF1dICsgYnl0ZVRvSGV4W2J1ZltvZmZzZXQgKyA1XV0gKyAnLScgKyBieXRlVG9IZXhbYnVmW29mZnNldCArIDZdXSArIGJ5dGVUb0hleFtidWZbb2Zmc2V0ICsgN11dICsgJy0nICsgYnl0ZVRvSGV4W2J1ZltvZmZzZXQgKyA4XV0gKyBieXRlVG9IZXhbYnVmW29mZnNldCArIDldXSArICctJyArIGJ5dGVUb0hleFtidWZbb2Zmc2V0ICsgMTBdXSArIGJ5dGVUb0hleFtidWZbb2Zmc2V0ICsgMTFdXSArIGJ5dGVUb0hleFtidWZbb2Zmc2V0ICsgMTJdXSArIGJ5dGVUb0hleFtidWZbb2Zmc2V0ICsgMTNdXSArIGJ5dGVUb0hleFtidWZbb2Zmc2V0ICsgMTRdXSArIGJ5dGVUb0hleFtidWZbb2Zmc2V0ICsgMTVdXSkudG9Mb3dlckNhc2UoKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgYnl0ZXNUb1V1aWQ7IiwiaW1wb3J0IHJuZyBmcm9tICcuL3JuZy5qcyc7XG5pbXBvcnQgYnl0ZXNUb1V1aWQgZnJvbSAnLi9ieXRlc1RvVXVpZC5qcyc7XG5cbmZ1bmN0aW9uIHY0KG9wdGlvbnMsIGJ1Ziwgb2Zmc2V0KSB7XG4gIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICB2YXIgcm5kcyA9IG9wdGlvbnMucmFuZG9tIHx8IChvcHRpb25zLnJuZyB8fCBybmcpKCk7IC8vIFBlciA0LjQsIHNldCBiaXRzIGZvciB2ZXJzaW9uIGFuZCBgY2xvY2tfc2VxX2hpX2FuZF9yZXNlcnZlZGBcblxuICBybmRzWzZdID0gcm5kc1s2XSAmIDB4MGYgfCAweDQwO1xuICBybmRzWzhdID0gcm5kc1s4XSAmIDB4M2YgfCAweDgwOyAvLyBDb3B5IGJ5dGVzIHRvIGJ1ZmZlciwgaWYgcHJvdmlkZWRcblxuICBpZiAoYnVmKSB7XG4gICAgb2Zmc2V0ID0gb2Zmc2V0IHx8IDA7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDE2OyArK2kpIHtcbiAgICAgIGJ1ZltvZmZzZXQgKyBpXSA9IHJuZHNbaV07XG4gICAgfVxuXG4gICAgcmV0dXJuIGJ1ZjtcbiAgfVxuXG4gIHJldHVybiBieXRlc1RvVXVpZChybmRzKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgdjQ7IiwiaW1wb3J0IHsgdjQgYXMgdXVpZHY0IH0gZnJvbSAndXVpZCc7XG5pbXBvcnQgV29ybGQgZnJvbSAnLi9Xb3JsZCc7XG5pbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tICcuL0NvbXBvbmVudCc7XG5pbXBvcnQgQ29tcG9uZW50Q29sbGVjdGlvbiBmcm9tICcuL0NvbXBvbmVudENvbGxlY3Rpb24nO1xuaW1wb3J0IHsgVGFnIH0gZnJvbSAnLi9UYWcnO1xuXG5leHBvcnQgdHlwZSBFbnRpdHlJZCA9IHN0cmluZztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRW50aXR5PENUPiB7XG4gIHByaXZhdGUgX2lkOiBzdHJpbmc7XG4gIHByaXZhdGUgX3dvcmxkOiBXb3JsZDxDVD47XG5cbiAgY29uc3RydWN0b3Iod29ybGQ6IFdvcmxkPENUPikge1xuICAgIHRoaXMuX2lkID0gdXVpZHY0KCk7XG4gICAgdGhpcy5fd29ybGQgPSB3b3JsZDtcblxuICAgIC8qXG4gICAgUmVnaXN0ZXJpbmcgd2l0aCB0aGUgV29ybGQuXG4gICAgKi9cbiAgICB0aGlzLl93b3JsZC5yZWdpc3RlckVudGl0eSh0aGlzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgYSBjb21wb25lbnQgdG8gYW4gRW50aXR5LCBkb2guXG4gICAqL1xuICBhZGQoY29tcG9uZW50OiBDb21wb25lbnQ8Q1Q+KTogRW50aXR5PENUPiB7XG4gICAgdGhpcy5fd29ybGQuc2V0KHRoaXMuX2lkLCBjb21wb25lbnQpO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGEgdGFnIHRvIGEgY29tcG9uZW50XG4gICAqL1xuICBhZGRUYWcodGFnOiBUYWcpOiBFbnRpdHk8Q1Q+IHtcbiAgICBjb25zdCBlbnRpdHlTZXQgPSB0aGlzLl93b3JsZC5lbnRpdGllc0J5VGFncy5oYXModGFnKVxuICAgICAgPyB0aGlzLl93b3JsZC5lbnRpdGllc0J5VGFncy5nZXQodGFnKVxuICAgICAgOiBuZXcgU2V0PEVudGl0eUlkPigpO1xuXG4gICAgaWYgKGVudGl0eVNldCkge1xuICAgICAgZW50aXR5U2V0LmFkZCh0aGlzLl9pZCk7XG4gICAgICB0aGlzLl93b3JsZC5lbnRpdGllc0J5VGFncy5zZXQodGFnLCBlbnRpdHlTZXQpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIERldGVybWluZXMgaWYgYW4gZW50aXR5IGhhcyBhIGNvbXBvbmVudCByZWxhdGVkIHRvIGl0LlxuICAgKi9cbiAgaGFzKGNUeXBlOiBDVCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGNjID0gdGhpcy5fd29ybGQuY29tcG9uZW50Q29sbGVjdGlvbnMuZ2V0KHRoaXMuX2lkKSB8fCBuZXcgQ29tcG9uZW50Q29sbGVjdGlvbjxDVD4oKTtcblxuICAgIHJldHVybiBjYy5oYXMoY1R5cGUpO1xuICB9XG5cbiAgaGFzVGFnKHRhZzogVGFnKTogYm9vbGVhbiB7XG4gICAgaWYgKHRoaXMuX3dvcmxkLmVudGl0aWVzQnlUYWdzLmhhcyh0YWcpKSB7XG4gICAgICBjb25zdCBlbnRpdHlTZXQgPSB0aGlzLl93b3JsZC5lbnRpdGllc0J5VGFncy5nZXQodGFnKTtcbiAgICAgIGlmIChlbnRpdHlTZXQpIHtcbiAgICAgICAgcmV0dXJuIGVudGl0eVNldC5oYXModGhpcy5faWQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYSBjb21wb25lbnQgdGhhdCBiZWxvbmdzIHRvIGFuIGVudGl0eS5cbiAgICovXG4gIGdldDxDPihjVHlwZTogQ1QpOiBDIHtcbiAgICBjb25zdCBjYyA9IHRoaXMuX3dvcmxkLmNvbXBvbmVudENvbGxlY3Rpb25zLmdldCh0aGlzLl9pZCkgfHwgbmV3IENvbXBvbmVudENvbGxlY3Rpb248Q1Q+KCk7XG5cbiAgICBjb25zdCBjb21wb25lbnQgPSBjYy5nZXQ8Qz4oY1R5cGUpO1xuXG4gICAgcmV0dXJuIGNvbXBvbmVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWxsIGNvbXBvbmVudHMgdGhhdCBoYXZlIGJlZW4gYWRkZWQgdG8gYW4gZW50aXR5LCB2aWEgYSBDb21wb25lbnRDb2xsZWN0aW9uXG4gICAqL1xuICBnZXRBbGwoKTogQ29tcG9uZW50Q29sbGVjdGlvbjxDVD4ge1xuICAgIHJldHVybiB0aGlzLl93b3JsZC5jb21wb25lbnRDb2xsZWN0aW9ucy5nZXQodGhpcy5faWQpIHx8IG5ldyBDb21wb25lbnRDb2xsZWN0aW9uPENUPigpO1xuICB9XG5cbiAgcmVtb3ZlKGNUeXBlOiBDVCk6IEVudGl0eTxDVD4ge1xuICAgIHRoaXMuX3dvcmxkLnJlbW92ZSh0aGlzLl9pZCwgY1R5cGUpO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICByZW1vdmVUYWcodGFnOiBzdHJpbmcgfCBudW1iZXIpOiBFbnRpdHk8Q1Q+IHtcbiAgICBpZiAodGhpcy5fd29ybGQuZW50aXRpZXNCeVRhZ3MuaGFzKHRhZykpIHtcbiAgICAgIGNvbnN0IGVudGl0eVNldCA9IHRoaXMuX3dvcmxkLmVudGl0aWVzQnlUYWdzLmdldCh0YWcpO1xuICAgICAgXG4gICAgICBpZiAoZW50aXR5U2V0KSB7XG4gICAgICAgIGVudGl0eVNldC5kZWxldGUodGhpcy5faWQpO1xuXG4gICAgICAgIGlmIChlbnRpdHlTZXQuc2l6ZSA9PT0gMCkge1xuICAgICAgICAgIHRoaXMuX3dvcmxkLmVudGl0aWVzQnlUYWdzLmRlbGV0ZSh0YWcpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqIENsZWFycyBhbGwgY29tcG9uZW50cyBmcm9tIGFuIEVudGl0eSAqL1xuICBjbGVhcigpOiBFbnRpdHk8Q1Q+IHtcbiAgICB0aGlzLl93b3JsZC5jbGVhckVudGl0eUNvbXBvbmVudHModGhpcy5faWQpO1xuXG4gICAgcmV0dXJuIHRoaXNcbiAgfVxuXG4gIGNsZWFyVGFncygpOiBFbnRpdHk8Q1Q+IHtcbiAgICBmb3IgKGNvbnN0IFt0YWcsIGVudGl0eVNldF0gb2YgdGhpcy5fd29ybGQuZW50aXRpZXNCeVRhZ3MuZW50cmllcygpKSB7XG4gICAgICBlbnRpdHlTZXQuZGVsZXRlKHRoaXMuX2lkKTtcblxuICAgICAgaWYgKGVudGl0eVNldC5zaXplID09PSAwKSB7XG4gICAgICAgIHRoaXMuX3dvcmxkLmVudGl0aWVzQnlUYWdzLmRlbGV0ZSh0YWcpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgZGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLl93b3JsZC5kZXN0cm95RW50aXR5KHRoaXMuX2lkKTtcbiAgfVxuXG4gIGdldCBpZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLl9pZDtcbiAgfVxuXG4gIGdldCB3b3JsZCgpOiBXb3JsZDxDVD4ge1xuICAgIHJldHVybiB0aGlzLl93b3JsZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWxsIGNvbXBvbmVudHMgdGhhdCBoYXZlIGJlZW4gYWRkZWQgdG8gYW4gZW50aXR5LCB2aWEgYSBDb21wb25lbnRDb2xsZWN0aW9uLlxuICAgKiBEb2VzIHRoZSBzYW1lIHRoaW5nIGFzIGVudGl0eUluc3RhbmNlLmdldEFsbCgpLlxuICAgKi9cbiAgZ2V0IGNvbXBvbmVudHMoKTogQ29tcG9uZW50Q29sbGVjdGlvbjxDVD4ge1xuICAgIHJldHVybiB0aGlzLl93b3JsZC5jb21wb25lbnRDb2xsZWN0aW9ucy5nZXQodGhpcy5faWQpIHx8IG5ldyBDb21wb25lbnRDb2xsZWN0aW9uPENUPigpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyBhbGwgdGhlIHRhZ3MgdGhhdCBoYXZlIGJlZW4gYWRkZWQgdG8gdGhpcyBlbnRpdHkuXG4gICAqL1xuICBnZXQgdGFncygpOiBTZXQ8VGFnPiB7XG4gICAgbGV0IHRhZ3MgPSBuZXcgU2V0PFRhZz4oKTtcbiAgICBmb3IgKGNvbnN0IFt0YWcsIGVudGl0eVNldF0gb2YgdGhpcy5fd29ybGQuZW50aXRpZXNCeVRhZ3MuZW50cmllcygpKSB7XG4gICAgICBpZiAoZW50aXR5U2V0Lmhhcyh0aGlzLl9pZCkpIHtcbiAgICAgICAgdGFncy5hZGQodGFnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGFncztcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRW50aXR5PENUPihcbiAgd29ybGQ6IFdvcmxkPENUPixcbik6IEVudGl0eTxDVD4ge1xuICBjb25zdCBlbnRpdHkgPSBuZXcgRW50aXR5PENUPih3b3JsZCk7XG5cbiAgcmV0dXJuIGVudGl0eTtcbn1cblxuXG4iLCJpbXBvcnQgV29ybGQgZnJvbSAnLi9Xb3JsZCc7XG5pbXBvcnQgRW50aXR5IGZyb20gJy4vRW50aXR5JztcbmltcG9ydCBDb21wb25lbnRDb2xsZWN0aW9uIGZyb20gJy4vQ29tcG9uZW50Q29sbGVjdGlvbic7XG5cbmV4cG9ydCB0eXBlIFN5c3RlbSA9ICgpID0+IHZvaWQ7XG5cbi8qKlxuICogQXJndW1lbnRzIHRoYXQgYXJlIHBhc3NlZCBpbnRvIGEgU3lzdGVtIGZ1bmN0aW9uIG9uIGVhY2ggaXRlcmF0aW9uLlxuICogVGhpcyBpcyBob3cgeW91IGFjY2VzIHRoaW5ncyBsaWtlIHRoZSBlbnRpdHkgdGhhdCBwYXJ0aWN1bGFyIGVudGl0eSB0byBhY3Qgb24sXG4gKiBhcyB3ZWxsIGFzIHNvbWUgb3RoZXIgaGVscGZ1bCBwYXJhbXMgbGlrZSBpZiB0aGUgZW50aXR5IGlzIHRoZSBmaXJzdCBvciBsYXN0IGVudGl0eVxuICogaW4gdGhlIGdyb3VwIG9mIGVudGl0aWVzIHRoYXQgYmVpbmcgaXRlcmF0ZWQgb3Zlci5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTeXN0ZW1GdW5jQXJnczxDVD4ge1xuICAvKipcbiAgICogVGhlIGN1cnJlbnQgZW50aXR5IGJlaW5nIGl0ZXJhdGVkLlxuICAgKi9cbiAgZW50aXR5OiBFbnRpdHk8Q1Q+O1xuICAvKipcbiAgICogVGhlIGNvbXBvbmVudHMgdGhhdCBiZWxvbmcgdG8gdGhlIGVudGl0eVxuICAgKi9cbiAgY29tcG9uZW50czogQ29tcG9uZW50Q29sbGVjdGlvbjxDVD47XG4gIC8qKlxuICAgKiBUaGUgV29ybGQgaW5zdGFuY2UuXG4gICAqIFVzZSB0aGlzIHRvIGFjY2VzcyBvdGhlciBlbnRpdGllcy5cbiAgICovXG4gIHdvcmxkOiBXb3JsZDxDVD47XG4gIGluZGV4OiBudW1iZXI7XG4gIHNpemU6IG51bWJlcjtcbiAgLyoqXG4gICAqIElzIHRoZSBmaXJzdCBlbnRpdHkgdG8gYmUgaXRlcmF0ZWQgb24gdGhpcyBydW4gb2YgYSBzeXN0ZW0uXG4gICAqIEhlbHBmdWwgZm9yIHNldHRpbmcgdXAgc3RhdGUgdGhhdCBpcyB0aGUgc2FtZSBmb3IgYWxsIGVudGl0aWVzIG9ubHkgb25jZS5cbiAgICovXG4gIGlzRmlyc3Q6IGJvb2xlYW47XG4gIC8qKlxuICAgKiBJcyB0aGUgbGFzdCBlbnRpdHkgdG8gYmUgaXRlcmF0ZWQgb24gdGhpcyBydW4gb2YgYSBzeXN0ZW0uXG4gICAqIENhbiBiZSBoZWxwZnVsIHRvIHRlYXIgZG93biBhbnl0aGluZyB0aGF0IHNob3VsZCBiZSBkZWFsdCB3aXRoIGFmdGVyIGFsbCB0aGUgZW50aXRlcyBoYXZlIHJhbi5cbiAgICovXG4gIGlzTGFzdDogYm9vbGVhbjtcbn1cblxuLyoqXG4gKiBGdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB3aGVuIGEgc3lzdGVtIGlzIHJ1bi5cbiAqL1xuZXhwb3J0IHR5cGUgU3lzdGVtRnVuYzxDVD4gPSAoXG4gIHN5dGVtRnVuY0FyZ3M6IFN5c3RlbUZ1bmNBcmdzPENUPixcbikgPT4gdm9pZDtcblxuLyoqXG4gKiBUaGlzIGlzIGhvdyB5b3UgY3JlYXRlIGEgU3lzdGVtLlxuICogQGV4YW1wbGVcbiAqIGBgYFxuICogY3JlYXRlU3lzdGVtKHdvcmxkLCBbJ0NvbXBvbmVudFR5cGUnXSwgKHsgZW50aXR5IH0pID0+ICdEbyBmdW4gc3lzdGVtIHRoaW5ncyBoZXJlLicpXG4gKiBgYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVN5c3RlbTxDVD4oXG4gIHdvcmxkOiBXb3JsZDxDVD4sXG4gIGNUeXBlczogQ1RbXSxcbiAgc3lzdGVtRnVuYzogU3lzdGVtRnVuYzxDVD5cbik6IFN5c3RlbSB7XG4gIHdvcmxkLnJlZ2lzdGVyU3lzdGVtKGNUeXBlcyk7XG5cbiAgcmV0dXJuICgpOiB2b2lkID0+IHtcbiAgICBsZXQgaW5kZXggPSAwO1xuICAgIGNvbnN0IHNpemUgPSB3b3JsZC5lbnRpdGllc0J5Q1R5cGVzLnNpemU7XG5cbiAgICAvLyBVc2VkIGZvciBtYXRjaGluZyB0aGUgYXJyYXkgb2YgQ29tcG9uZW50VHlwZXMgd2hpY2ggaXMgdGhlIGtleVxuICAgIC8vIG9mIHdoZXJlIHRoZSBDb21wb25lbnRDb2xsZWN0aW9uIGlzLCB3aXRoIHRoZSBhcnJheSBvZiBDb21wb25lbnRUeXBlc1xuICAgIC8vIHRoYXQgYXJlIHBhc3Nlcy5cbiAgICAvLyBNaWdodCBiZSBuaWNlIGluIHRoZSBmdXR1cmUgdG8gZ28gYmFjayB0byBhIHJlZiBjaGVjayBvbiBjVHlwZXMsIGJ1dFxuICAgIC8vIGZvciBub3cgdGhpcyBkb2Vzbid0IHNlZW0gdG8gYmUgdGhhdCBtdWNoIG9mIGEgcGVyZiBoaXQuXG4gICAgLy8gZm9yIChjb25zdCBjdCBvZiB3b3JsZC5lbnRpdGllc0J5Q1R5cGVzLmtleXMoKSkge1xuICAgIC8vICAgaWYgKGNUeXBlcy5sZW5ndGggPT09IGN0Lmxlbmd0aCAmJiBjVHlwZXMuZXZlcnkoYyA9PiBjdC5pbmNsdWRlcyhjKSkpIHtcbiAgICAvLyAgICAgZm9yIChjb25zdCBlaWQgb2Ygd29ybGQuZW50aXRpZXNCeUNUeXBlcy5nZXQoY1R5cGVzKSkge1xuICAgIC8vICAgICAgIGNvbnN0IGFyZ3M6IFN5c3RlbUZ1bmNBcmdzPENUPiA9IHtcbiAgICAvLyAgICAgICAgIGVudGl0eTogd29ybGQuZW50aXRpZXMuZ2V0KGVpZCksXG4gICAgLy8gICAgICAgICBjb21wb25lbnRzOiB3b3JsZC5jb21wb25lbnRDb2xsZWN0aW9ucy5nZXQoZWlkKSxcbiAgICAvLyAgICAgICAgIHdvcmxkLFxuICAgIC8vICAgICAgICAgaW5kZXgsXG4gICAgLy8gICAgICAgICBzaXplLFxuICAgIC8vICAgICAgICAgaXNGaXJzdDogaW5kZXggPT09IDAsXG4gICAgLy8gICAgICAgICBpc0xhc3Q6IGluZGV4ICsgMSA9PT0gc2l6ZSxcbiAgICAvLyAgICAgICB9XG4gICAgXG4gICAgLy8gICAgICAgc3lzdGVtRnVuYyhhcmdzKTtcbiAgICBcbiAgICAvLyAgICAgICBpbmRleCArPSAxO1xuICAgIC8vICAgICB9XG4gICAgLy8gICB9XG4gICAgLy8gfVxuXG4gICAgY29uc3QgY1R5cGVBcnJzID0gd29ybGQuZW50aXRpZXNCeUNUeXBlcy5nZXQoY1R5cGVzKSB8fCBuZXcgU2V0KCk7XG5cbiAgICBmb3IgKGNvbnN0IGVpZCBvZiBjVHlwZUFycnMpIHtcbiAgICAgIGNvbnN0IGFyZ3M6IFN5c3RlbUZ1bmNBcmdzPENUPiA9IHtcbiAgICAgICAgZW50aXR5OiB3b3JsZC5lbnRpdGllcy5nZXQoZWlkKSB8fCBuZXcgRW50aXR5PENUPih3b3JsZCksXG4gICAgICAgIGNvbXBvbmVudHM6IHdvcmxkLmNvbXBvbmVudENvbGxlY3Rpb25zLmdldChlaWQpIHx8IG5ldyBDb21wb25lbnRDb2xsZWN0aW9uPENUPigpLFxuICAgICAgICB3b3JsZCxcbiAgICAgICAgaW5kZXgsXG4gICAgICAgIHNpemUsXG4gICAgICAgIGlzRmlyc3Q6IGluZGV4ID09PSAwLFxuICAgICAgICBpc0xhc3Q6IGluZGV4ICsgMSA9PT0gc2l6ZSxcbiAgICAgIH1cblxuICAgICAgc3lzdGVtRnVuYyhhcmdzKTtcblxuICAgICAgaW5kZXggKz0gMTtcbiAgICB9XG4gIH1cbn1cbiIsImltcG9ydCBXb3JsZCBmcm9tICcuL1dvcmxkJztcbmltcG9ydCB7IGNyZWF0ZUVudGl0eSB9IGZyb20gJy4vRW50aXR5JztcbmltcG9ydCB7IGNyZWF0ZVN5c3RlbSB9IGZyb20gJy4vU3lzdGVtJztcblxuZXhwb3J0IHtcbiAgV29ybGQsXG4gIGNyZWF0ZUVudGl0eSxcbiAgY3JlYXRlU3lzdGVtLFxufTtcbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///1\n')}])}));